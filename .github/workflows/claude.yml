name: Feedback Intake

on:
  issues:
    types: [opened]

permissions:
  issues: write

jobs:
  acknowledge-and-dispatch:
    if: github.event_name == 'issues'
    runs-on: ubuntu-latest
    steps:
      # Post a friendly public acknowledgment (no technical details)
      - name: Acknowledge feedback
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: `Thanks for your feedback! Our team will review this and get back to you.\n\nWe'll update this issue when there's progress to share.`
            });

      # Dispatch to private repo for technical triage
      - name: Dispatch to private repo
        uses: peter-evans/repository-dispatch@v3
        with:
          token: ${{ secrets.DISPATCH_PAT }}
          repository: favorize-app/favorize-flutter
          event-type: feedback-triage
          client-payload: |
            {
              "issue_number": ${{ github.event.issue.number }},
              "issue_title": "${{ github.event.issue.title }}",
              "issue_url": "${{ github.event.issue.html_url }}",
              "issue_body": ${{ toJSON(github.event.issue.body) }},
              "labels": ${{ toJSON(github.event.issue.labels.*.name) }}
            }
